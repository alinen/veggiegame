<!DOCTYPE html>
<html>
<head>
<title>Attack of the Killer Vegetables</title>
<meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
<script type="text/javascript" src="AssetMgr.js"></script>
<script type="text/javascript" src="Screen.js"></script>
<script type="text/javascript" src="TitleScreen.js"></script>
<script type="text/javascript" src="GameScreen.js"></script>
<script type="text/javascript" src="GameOverScreen.js"></script>
<script type="text/javascript" src="Utils.js"></script>
<script type="text/javascript" src="Entity.js"></script>
<script type="text/javascript" src="KillerVeggie.js"></script>
<script type="text/javascript" src="Car.js"></script>
<script type="text/javascript" src="Missile.js"></script>
<script type="text/javascript" src="Explosion.js"></script>
<script type="text/javascript" src="Peapod.js"></script>
<script type="text/javascript" src="KillerPea.js"></script>
<script>
var theAssetMgr = new AssetMgr();
var screens = new Array();
var currentScreen = 0;
var lastTime = 0;

function tick() 
{
    var timeNow = new Date().getTime();
    var dt = (timeNow - lastTime) * 0.0001;
    lastTime = timeNow;

    screens[currentScreen].update(dt);
    screens[currentScreen].draw(theAssetMgr);

    if (screens[currentScreen].finished) {
        screens[currentScreen].cleanup();
        currentScreen = (currentScreen + 1) % screens.length;
        screens[currentScreen].init();
    }
    
    window.requestAnimationFrame(tick);
}

function handleKeyUp(e) {
    // don't forget to disable vimfx!
    screens[currentScreen].keyUp(e);
}

function handleKeyDown(e) {
    // don't forget to disable vimfx!
    screens[currentScreen].keyDown(e);
}

function handleMouseMove(e) {
    screens[currentScreen].mouseMove(e);
}

function handleMouseDown(e) {
    screens[currentScreen].mouseDown(e);
}

function launchGame() {
    theAssetMgr.loadAssets();

    var canvas = document.getElementById("assets");
    var svgDoc = canvas.contentDocument;
    var width = theAssetMgr.width(theAssetMgr.SCENE);
    var height = theAssetMgr.height(theAssetMgr.SCENE);

    var titleScreen = new TitleScreen(width, height);
    var gameScreen = new GameScreen(width, height);
    var gameOverScreen = new GameOverScreen(width, height);

    screens.push(titleScreen);
    screens.push(gameScreen);
    screens.push(gameOverScreen);
    screens[currentScreen].init();

    lastTime = new Date().getTime();
    svgDoc.addEventListener("keyup", handleKeyUp);
    svgDoc.addEventListener("keydown", handleKeyDown);
    window.addEventListener("mousemove", handleMouseMove);
    window.addEventListener("mousedown", handleMouseDown);
    window.requestAnimationFrame(tick);
}

</script>
</head>
<body style="background:#000000" onload="launchGame();">
<object data="./imgs/veggies.svg" type="image/svg+xml" id="assets" style="position: absolute; top: 0px; left: 0px"></object>
<!--<canvas id="canvas" style="position: absolute; top: 0px; left: 0px"></canvas>-->
</body>
</html>

